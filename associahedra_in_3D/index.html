<head>
    <link rel="stylesheet" href="css/cmun-serif.css"></link>
    <style> 
    body {
      font-family: "Computer Modern Serif", serif;
    }
    .graph-info-msg {
    top: 50%;
    width: 100%;
    text-align: center;
    color: rgb(97, 177, 252);
    opacity: 1;
    font-size: 22px;
    position: absolute;
    }
    .wrapper {
        position: relative;
        }
    #info{
    position: absolute;
    top: 0;
    left:1em;
    right: 0;
    }
    </style>
    <script src="//unpkg.com/three"></script>
    <script src="https://unpkg.com/dat.gui@0.7.7/build/dat.gui.js"></script>
    <script src="//unpkg.com/3d-force-graph"></script>
  </head>
  
  <body>
    <div class = "wrapper">
        <div id="3d-graph"></div>
        <div id="info">
            <div id = "div1">
                Vertices: 14 Edges: 21
            </div>
    </div>
    
    <script>
    const verts = [1, 1, 2, 5, 14, 42, 132, 429, 1430, 4862]; //No reason to constantly calculate factorials.
    const edges = [0, 0, 1, 5, 21, 84, 330, 1287, 5005, 19448]
    function textBox(n) {
        // updates the graph info
        num_nodes = verts[n]
        num_links = edges[n]
        document.getElementById("div1").innerHTML = "Vertices: " + num_nodes.toString() + " Edges: " + num_links.toString();
    }
    const showAnimation = false;
    const showArrowDirection = false;
    const Graph = ForceGraph3D()
        (document.getElementById('3d-graph'))
            .jsonUrl('binary_words_of_5'+'.json') // Default associahedron
            .nodeLabel('id')
            .nodeLabel(node => node.name)
            .nodeThreeObject(function(){})
            .nodeRelSize(7)
            .nodeOpacity(1)
            .nodeColor(node => "rgb(114, 143, 255)")
            .nodeResolution(20)
            .linkOpacity(0.9)
            .linkWidth(0.3)  
            .linkColor(link=>"rgba(0,0,0,1)")
            .nodeLabel(label => `<span style= "color: rgb(0, 0, 0); lack">${label.name}</span>`)
            .backgroundColor("#ffffff")
            .onNodeDragEnd(node => { // Fix nodes after drag and drop
                node.fx = node.x;
                node.fy = node.y;
                node.fz = node.z;
            })
    Graph.d3Force('charge').strength(-500) // Choice of force + repulsion strength
    if(showAnimation){// Disables interaction and enables rotation of the associahedron.
        const distance = 1400;
        Graph.enableNodeDrag(false)
        Graph.enableNavigationControls(false)
        Graph.showNavInfo(false)
        Graph.cameraPosition({ z: distance })
        let angle = 0;
        setInterval(() => {
        Graph.cameraPosition({
            x: distance * Math.sin(angle),
            z: distance * Math.cos(angle)});
            angle += Math.PI / 700;
            }, 10)
    }

    // Define GUI to presentation of associahedron 
    const settings = {
        K_n : 5,
        showVertices: true,
        BinaryWords : false,
        Arrows : false,
        What_is_this: function() 
        { 
            window.location = "https://www.justgooddesign.com";
        },
        explode: function () {
          alert('Bang!');
        },
    };
    const gui = new dat.GUI();
    gui.add(settings, 'explode');
    const associahedronDimension = gui.add(settings, 'K_n', 1, 10).step(1) // Adds the bar which controls which associahedron is present
    associahedronDimension.onFinishChange(
        function updateAssociahedron(n) { // Upon change, change the .json file and resize the camera to fit new objects
            Graph.jsonUrl('binary_words_of_'+ n.toString() +'.json');
            textBox(n-1);
            console.log(Graph.graphData()["nodes"].length)
            Graph.zoomToFit(1000, 50);
        }
    );
    // Option to show or suppress parenthesizations
    gui.add(settings, 'BinaryWords').onChange(function (showBinaryWords) {
        if(settings.showVertices){
            if(showBinaryWords){
            updateWords()
        }
        else{
            Graph.nodeThreeObject(function(){});
        }
    }
    }); 
    // Option to show or suppress arrow tips
    gui.add(settings, 'Arrows').onChange(function (showArrow) {
        if(showArrow){
            Graph.linkDirectionalArrowLength(5)
            Graph.linkDirectionalArrowRelPos(0.8)
        }
        else{
            Graph.linkDirectionalArrowLength(0)
            Graph.linkDirectionalArrowRelPos(0)
        }
    }); 
    
    // Option to show or suppress all vertices
    gui.add(settings, 'showVertices').onChange(function (showVertices) {
        if(!showVertices){
            Graph.nodeThreeObject(function() {
            // use a sphere as a drag handle
            const obj = new THREE.Mesh(
            new THREE.SphereGeometry(7),
            new THREE.MeshBasicMaterial({ depthWrite: false, transparent: true, opacity: 0 })
            );
            return obj});
        }
        else if(settings.BinaryWords){
            updateWords()
        }
        else{
            Graph.nodeThreeObject(function(){});
        }
    }); 
    // Updates the vertices to present the binary words
    function updateWords(){
        // To show binary words, load the LaTeX-ed images
        Graph.nodeThreeObject(({ img }) => {
        // use a sphere as a drag handle
        const obj = new THREE.Mesh(
        new THREE.SphereGeometry(7),
        new THREE.MeshBasicMaterial({ depthWrite: false, transparent: true, opacity: 0 })
        );
        // add img sprite as child
        const imgTexture = new THREE.TextureLoader().load(`/imgs/${img}`);
        const material = new THREE.SpriteMaterial({ map: imgTexture });
        const sprite = new THREE.Sprite(material);
        
        if(Graph.jsonUrl() == "binary_words_of_1.json"){
            sprite.scale.set(10, 7);
        }
        if(Graph.jsonUrl() == "binary_words_of_2.json"){
            sprite.scale.set(15, 7);
        }
        if(Graph.jsonUrl() == "binary_words_of_3.json"){
            sprite.scale.set(30, 15);
        }
        if(Graph.jsonUrl() == "binary_words_of_4.json"){
            sprite.scale.set(50, 15);
        }
        if(Graph.jsonUrl() == "binary_words_of_5.json"){
            sprite.scale.set(100, 20);
        }
        if(Graph.jsonUrl() == "binary_words_of_6.json"){
            sprite.scale.set(120, 20);
        }
        else if(Graph.jsonUrl() == "binary_words_of_7.json"){
            sprite.scale.set(140, 20);
        }
        obj.add(sprite);
        return obj;
        });
    }

    </script>
  </body>